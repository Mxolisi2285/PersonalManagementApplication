<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Journal</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">

    <!-- TinyMCE -->
    <script src="https://cdn.tiny.cloud/1/API_KEY/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        tinymce.init({
            selector: '#noteContent',
            menubar: false,
            plugins: 'lists link image preview',
            toolbar: 'undo redo | formatselect | bold italic underline | bullist numlist | link image | preview',
            height: 200
        });
    </script>
</head>
<body>
<header>
    <h1>My Journal</h1>
    <!-- Logout Button -->
    <form th:action="@{/logout}" method="post" style="display:inline;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" class="btn btn-logout">Logout</button>
    </form>
</header>

<main>
    <!-- CREATE NOTE -->
    <section class="create-note">
        <h2>Create New Note</h2>
        <form th:action="@{/notes/create}" method="post" id="createNoteForm">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="text" name="title" placeholder="Title" required />
            <textarea id="noteContent" name="content" placeholder="Write your note here..." required></textarea>
            <button type="submit" class="btn btn-primary">Add Note</button>
        </form>
    </section>

    <!-- LIST NOTES -->
    <section class="notes-list">
        <h2>Your Notes</h2>
        <div th:if="${#lists.isEmpty(notes)}">
            <p>No notes yet. Start by creating one!</p>
        </div>
        <div th:each="note : ${notes}" class="note-card">
            <h3 th:text="${note.title}">Note Title</h3>
            <p th:utext="${note.content}">Note Content</p>
            <div class="note-actions">
                <a th:href="@{/notes/edit/{id}(id=${note.id})}" class="btn btn-edit">Edit</a>
                <a th:href="@{/notes/delete/{id}(id=${note.id})}" class="btn btn-delete"
                   onclick="return confirm('Are you sure you want to delete this note?');">Delete</a>
            </div>
        </div>
    </section>
</main>

<script>
    // Save TinyMCE content before form submit
    document.getElementById('createNoteForm').addEventListener('submit', function(e) {
        tinymce.triggerSave();
    });
</script>
</body>
</html>
